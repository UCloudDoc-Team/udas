# 3、动态脱敏

动态脱敏模块用于管理在脱敏系统中所有动态脱敏任务的配置， 包括对代理用户、 应用层账号以及代理数据库进行配置。

## 3.1 代理用户配置

管理代理用户的信息，可对代理用户进行增加、删除、修改、查询操作。添加的代理用户可被应用于代理数据库配置中。

### 3.1.1 添加代理用户

点击添加按钮，输入代理用户名和密码，点击保存即可添加成功。不可添加重复的代理用户名。 

![](/images/operation/rule/ddm/ddm_1.png)

### 3.1.2 删除代理用户

添加的代理用户可被删除，首先选中代理服务账号，然后点击页面上的“删除”，在弹框中点击“确认”即可。同样有单个删除、多个删除和整页删除。  

![](/images/operation/rule/ddm/ddm_2.png)

若已应用到代理数据库中，则代理数据库中的代理用户也会对应被删除。

### 3.1.3 修改代理用户

鼠标悬停用户，右侧会出现修改按钮，点击按钮，可修改代理用户密码。修改后需使用新密码重新登录代理数据库。

![](/images/operation/rule/ddm/ddm_3.png)

## 3.2 应用层账号配置

管理应用层账号的配置信息，可对应用层账号进行增加、删除、修改、查询操作。 选择某一个应用层账号可在引用任务列表查看代理数据库配置中应用、该应用层用户的代理服务名及状态。  

![](/images/operation/rule/ddm/ddm_4.png)

### 3.2.1 添加应用层账号

点击添加按钮，可添加应用层账号。添加应用层账号有两种方式：手动添加和文件导入。添加的应用层账号可被应用于代理数据库配置中，添加默认以文件导入的形式。

![](/images/operation/rule/ddm/ddm_5.png)

a. 文件导入: 导入方式选择清除原表会删除之前添加的所有应用层账号，若选择直接插入则会保留之前添加的应用层账号；导入的文件格式要求每行一个账号；本系统在导入应用层账号时会自动去重。

b. 手动添加：添加方式选择手动添加，账号输入框中输入账号信息即可。可点击新增账号的按钮，新增多个应用层账号。 

#### 3.2.2 删除应用层账号

选中代理服务账号，然后点击页面上的“删除”，在弹框中点击“确认”即可。同样有单个删除、多个删除和整页删除。若已应用到代理数据库中，则代理数据库中的应用层账号也会对应被删除。

![](/images/operation/rule/ddm/ddm_6.png)

#### 3.2.3 修改应用层账号

鼠标悬停用户，点击右侧修改按钮，可修改应用层账户名。若已应用到代理数据库中，则代理数据库中的应用层账号也会对应被修改。

![](/images/operation/rule/ddm/ddm_7.png)

## 3.3 代理服务配置

主要是对动态脱敏任务的管理，如添加、修改、查看详情等。

#### 3.3.1 添加任务

点击“添加”按钮后进入代理数据库配置界面。

![](/images/operation/rule/ddm/ddm_8.png)

添加和选择如下信息：

| 任务名称     | Test123                               |
| ------------ | ------------------------------------- |
| 数据源类型   | oracle（默认）                        |
| 数据源       | oracle11g（根据需要从源数据库中选择） |
| 代理用户     | user（从代理服务账号中选择）          |
| 最小连接数   | 1                                     |
| 最大连接数   | 8                                     |
| 返回行数限制 | 100（非必填）                         |
| 选择时间     | （每天）10:00-16:00                   |

a. 数据源类型：根据数据库的类型做分类。

b. 数据源：数据源中仅可对源数据库模块中审核通过并且表结构更新状态位已完成的源数据库进行选择。

c. 代理用户：来自于代理服务账号，可以单选也可以多选。

d.选择时间：在选定的时间段内可以使用动态代理服务，非选定的时间内代理服务不可用。

点击“下一步”，选择要脱敏的表和字段。

![](/images/operation/rule/ddm/ddm_9.png)

点击“下一步”，选择该动态脱敏作业的全局脱敏规则，字段规则非必选项。

![](/images/operation/rule/ddm/ddm_10.png)

a. 应用规则组：此功能的前提是该数据库进行了敏感数据扫描的操作，应用规则组只可给匹配上了敏感类型的字段应用对应敏感类型的脱敏规则。系统中内置5种规则组，也可应用自定义的规则组

点击“下一步”，进入账号自定义及黑白名单配置，账号自定义和黑白名单非必填项，根据实际需要进行相应的配置。点击“完成”即可完成动态代理任务的添加。

![](/images/operation/rule/ddm/ddm_11.png)

a. 账号自定义：点击账号自定义在弹出的账号自定义界面，选择账号类型，可选择代理用户或者应用层账号，选择账号和规则名称点击“添加”后点击“完成”按钮，则完成账号自定义的添加。此功能可实现对不用的账号应用不同的脱敏规则。

![](/images/operation/rule/ddm/ddm_12.png)

b. 黑白名单：点击黑白名单在弹出的黑白名单添加页面，可添加黑白名单关键词。在黑名单关键词输入框中输入指定的关键词点击“添加”，即可添加一个黑名单。白名单添加方式和黑名单一样。点击“确定”，即可对该表的字段成功添加自定义的黑白名单。

![](/images/operation/rule/ddm/ddm_13.png)

a. 账号信息-查看详情：在此可以查看到该任务中配置的自定义账号的信息

b. 黑白名单-查看详情：在此可以查看到该任务中配置的黑白名单的信息；匹配上黑名单的数据则查询不会显示该行数据，匹配上白名单的数据则该行数据不会进行脱敏，如果同一个关键词同时出现在黑名单和白名单中则以黑名单为准。

添加成功后仅任务审核通过后，任务才可被启动。
