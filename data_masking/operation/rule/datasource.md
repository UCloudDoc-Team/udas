# 1、 数据源管理

数据源管理是脱敏任务执行前提，它包括数据源管理和敏感数据扫描，数据源管理是对源目数据库的添加、修改、查看、删除以及实现数据源和表对象更新；敏感数据扫描是对各个源数据库中敏感字段的管理。

## 1.1 数据源配置

在此处配置需要脱敏的数据库，支持十几种数据库类型的脱敏，包括后关系型数据库Caché，hive、mongoDB等大数据库的脱敏，达梦、GaussDB等国产数据库的脱敏，一些主流的数据库如Oracle、MySQL、sqlserver、DB2、Informix、sybase的脱敏。

### 1.1.1 添加数据源

点击界面“添加”按钮，弹出添加数据源对话框：

![](/images/operation/rule/datasource/datasource_1.png)

以Oracle数据库为例，输入以下内容：  

| 名称       | Oracle_test                                          |
| ---------- | ---------------------------------------------------- |
| 数据库类型 | Oracle（默认为Oracle，可根据需求选择其他数据库类型） |
| IP：端口   | 172.19.1.202:1521                                    |
| 用户名     | scott                                                |
| 密码       | Ceshi123                                             |
| SID        | orcl                                                 |
| 角色名     | Defalut（默认default，请根据实际情况进行选择）       |
| 编码       | 默认                                                 |
| 用户       | （非必填项，不选择则为上述用户名中的用户）           |

a.IP端口：支持IPV4地址段的数据源添加，也支持同网段IPV6数据源的添加；

b. 用户：Oracle数据库的源数据库用户可选择多个；

c. Kerberos认证：该开关仅hive数据库有。默认关闭；开启后需要上传用户用于Kerberos认证的keytab文件以及krb5.conf配置文件，填写hiveserver2的principal名称，目前支持的带认证的平台有华为FusionInSight、Apache Hadoop以及CDH三种。

填写完成后，进行测试连接。测试连接成功后点击添加按钮即可完成源数据库的添加。源目数据库的添加方式都是一样的。数据源配置在进行测试连接时若测试连接时出错，会给出对应的错误信息。根据对应的提示信息能够快速的定位到测试连接出错原因。

![](/images/operation/rule/datasource/datasource_2.png)

### 1.1.2 更新数据源

源数据库配置列表的操作栏中，可以点击更新按钮对源数据进行更新表结构的操作。目标数据无此操作。

![](/images/operation/rule/datasource/datasource_3.png)

注意：在更新数据源信息时，若数据库中的表、字段信息太多时，更新时间可能较长。

更新完成之后，可以点击操作栏的列表按钮查看到该库中所有的表名、字段名、字段类型、字段描述、字段长度以及数据库的基础配置信息。

![](/images/operation/rule/datasource/datasource_4.png)

### 1.1.3 修改和删除

点击数据源配置列表操作栏中的修改按钮可以实现对数据库配置信息的修改，一般数据库的IP端口、数据库类型、数据库名是不可修改的。   

![](/images/operation/rule/datasource/datasource_5.png)

注意：当数据源被修改之后，就需要重新审核并执行更新表结构的操作。

首先要选中需要删除的数据库，然后点击数据源配置页面的按钮“删除”，在弹出的提示框中点击“确认”按钮删除数据源。删除可进行单个删除、多条删除和整页删除，单个删除即手动选中一条数据源左侧的空格，多个删除即手动选中多条数据源左侧的空格。下图为整页删除，需选中每一页标题栏 “名称”左侧的空格。

![](/images/operation/rule/datasource/datasource_6.png)

### 1.1.4 更新表对象

源数据库配置列表的操作栏中，可以点击更新按钮对源数据进行更新表对象的操作。更新表对象主要包括更新表的索引、存储过程和视图。数据库需要先更新数据源才能更新表对象，如果不更新数据源就更新表对象会有合理的提示。目标数据无此操作。

![](/images/operation/rule/datasource/datasource_7.png)

## 1.2 消息队列配置

目前系统仅支持kafka消息队列的脱敏，脱敏的格式支持json格式数据的脱敏。在本模块中主要添加源目kafka的配置信息，以便后续后续脱敏任务的引用。

### 1.2.1 添加配置

在消息队列配置中点击“添加”，弹出添加消息队列配置对话框：

![](/images/operation/rule/datasource/datasource_8.png)

在弹出的对话框中输入如下信息：

| 名称         | test                                 |
| ------------ | ------------------------------------ |
| 消息队列类型 | Kafka（目前仅kafka一种类型）         |
| 部署类型     | 单机                                 |
| IP:端口      | 172.19.1.119:9092                    |
| topic列表    | cmy_nbd_topic1（在下拉框中进行选择） |
| 消费组       | test                                 |
| Kerberos认证 | 关闭（默认）                         |

a. 部署类型：目前支持单机和集群两种方式，在集群的模式下需要在地址输入框中输入所有的节点IP和端口，并且需要在host文件中配置主机名与IP的映射关系。

b. kerberos认证：目前系统支持apache hadoop平台带kerberos认证的kafka的脱敏，在配置该种环境的kafka配置信息时需要上传对应的认证文件、填写对应的principal名称。

填写完成后可对kakfa的配置信息进行测试连接，验证是否可正常连接使用。Kafka的脱敏无需更新数据源，并且kafka目前暂无敏感数据扫描功能。同数据库一样，仅有审核通过的消息队列源与目标才能被脱敏任务所引用。

![](/images/operation/rule/datasource/datasource_9.png)

### 1.2.2 修改和删除

点击消息队列配置列表操作栏中的修改按钮可以实现对消息队列配置信息的修改，一般名称、消息队列类型、部署方式、IP端口不可进行修改。

![](/images/operation/rule/datasource/datasource_10.png)

若需要对消息队列配置信息进行删除，在消息队列配置页面选中需要删除的配置，点击“删除”按钮即可，系统支持批量删除操作。

![](/images/operation/rule/datasource/datasource_11.png)

## 1.3 敏感数据扫描

敏感数据扫描主要帮助用户定位数据库表中的敏感字段，从而更顺畅地进行脱敏操作。这一步骤是基于数据源配置的，操作员将数据源配置之后，还需更新数据源并且经审核员审核通过之后才能进行敏感数据扫描。

### 1.3.1 添加任务

点击敏感数据扫描界面的“添加”按钮，选择刚刚审核通过的数据源。若选择的数据源在添加时没有进行更新操作则需更新数据源。

![](/images/operation/rule/datasource/datasource_12.png)

数据表选择全表，根据需求填入样本数和匹配率。执行方式默认为“手动执行”。数据填入完成后点击“保存”即可完成任务添加。执行方式还有定时执行和周期执行两种。

![](/images/operation/rule/datasource/datasource_13.png)

a. 定时执行：即为选择一个执行的时间，系统到了选择的时间之后，会自动进行敏感任务的扫描，无需手动开启。

b. 周期执行：分为三种（按天，按周，按月），可以根据意愿选择执行方式和时间。在选择周期执行时间之后任务会按照周期严格执行，每到所选时间执行一次。

### 1.3.2 扫描数据

完成敏感数据扫描任务之后，如果执行方式为手动执行，需要在添加的任务栏中点击右侧操作一栏中的开始按钮，手动点击启动之后，页面弹出任务已启动的提示，敏感数据扫描任务状态转换为“等待中”，此时系统会判定是否有其他任务在执行，若没有其它正在执行的任务，15秒内任务状态转换为进行中。

![](/images/operation/rule/datasource/datasource_14.png)

注意：在敏感数据扫描时，若数据库中的表、字段信息太多时，扫描时间可能较长。

扫描完成之后，可以点击操作栏的详情按钮查看本次任务执行结果，包括该库中的表名、字段名、以及字段对应的敏感类型和匹配率。

![](/images/operation/rule/datasource/datasource_15.png)

一个库的敏感数据扫描可执行多次，在结果页面中可以和上一次执行结果进行对比，借此来判断扫描的准确性。

![](/images/operation/rule/datasource/datasource_16.png)

对于扫描的结果可以点击“导出文件”按钮来进行保存，文件保存方式可选Excel和PDF。确定文件格式之后，点击按钮“确认”即可等待下载。

![](/images/operation/rule/datasource/datasource_17.png)

注意：在导出文件时，若数据库中的表、字段信息太多时，导出时间可能较长。

### 1.3.3 修改和删除

在修改敏感数据扫描任务页面可对所选表名、样本数、匹配率和执行方式等进行修改。

![](/images/operation/rule/datasource/datasource_18.png)

注意：样本数为在源数据库中取样的数据量。匹配率为样本数中敏感数据所占的比率

选择任意一条或多条敏感数据扫描任务，点击[删除]按钮，可删除选中任务。

![](/images/operation/rule/datasource/datasource_19.png)
